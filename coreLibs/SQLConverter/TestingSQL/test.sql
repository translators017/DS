CREATE MULTISET VOLATILE TABLE v_daily_dtl_fee AS ( select SM.c_prop_cd , SM.i_slot_num , SM.c_sds_cd , SDD.d_game_date , ( SDD.f_coin_drop + SDD.f_curr_total + SDD.f_coupon_total + ZEROIFNULL ( SDD.f_tk_ci_day ) + ZEROIFNULL ( SDD.f_tk_ni_day ) + ZEROIFNULL ( SDD.f_ti_cp_day ) + ZEROIFNULL ( SDD.f_eft_ci_y ) + ZEROIFNULL ( case when Cast ( SDD.f_eft_ni_y as Decimal ( 12 , 2 ) ) = 5314892.06 then 0 else SDD.f_eft_ni_y end ) - SDD.f_hand_paid_jkpt - SDD.f_mach_fills - ZEROIFNULL ( SDD.f_tk_co_day ) - ZEROIFNULL ( SDD.f_tko_n_day ) - SDD.f_eft_co_y - SDD.f_eft_no_y ) AS f_mtr_win_d , Cast ( Case when SM.c_participation = '1' then ( SM.f_coin_in_pct * SDD.f_coin_in ) * ( 1 - SM.f_discount_pct ) when SM.c_participation = '2' then ( Case when SM.f_daily_fee_cap > 0 then LEAST ( ( f_mtr_win_d * SM.f_revenue_pct ) , ( SM.f_daily_fee_cap * ( 1 - SM.f_discount_pct ) ) ) else ( ( f_mtr_win_d * SM.f_revenue_pct ) * ( 1 - SM.f_discount_pct ) ) End ) when SM.c_participation = '3' then ( ( SDD.i_online_flag * SM.f_daily_lease_fee ) * ( 1 - SM.f_discount_pct ) ) when SM.c_participation = '4' then ( ( SDD.i_online_flag * SM.f_daily_sw_fee ) * ( 1 - SM.f_discount_pct ) ) when SM.c_participation = '5' then ( ( SDD.i_online_flag * SM.f_daily_maint_fee ) * ( 1 - SM.f_discount_pct ) ) when SM.c_participation = '6' then 0 when SM.c_participation in ( '7' , '8' ) then ( ( SM.f_coin_in_pct * SDD.f_coin_in ) + ( SDD.i_online_flag * SM.f_lease_sw_maint_fee ) ) * ( 1 - SM.f_discount_pct ) when SM.c_participation = '9' then ( SDD.i_online_flag * SM.f_lease_sw_maint_fee ) * ( 1 - SM.f_discount_pct ) else 0 End as Decimal ( 15 , 2 ) ) as f_participation_fee_calc FROM ${SLOTDB}.slot_master SM JOIN ${SLOTDB}.slot_daily_dtl SDD On SM.c_prop_cd = SDD.c_prop_cd and SM.i_slot_num = SDD.i_slot_num and SM.c_sds_cd = SDD.c_sds_cd and SDD.d_game_date between date '${N_DATE}' and date '${C_DATE}' and SDD.d_game_date between SM.d_start_date and SM.d_end_date ) WITH DATA PRIMARY INDEX ( i_slot_num , d_game_date , c_sds_cd ) ON COMMIT PRESERVE ROWS ;